<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<th:block th:replace="~{layout/base :: maket(~{::dashboard})}">
    <th:block th:fragment="dashboard">
        <h1>Добро пожаловать в личный кабинет</h1>

        <div class="profile-section" th:unless="${isAdminOrDoctor}">
            <h2>Ваш профиль</h2>
            <form th:action="@{/client/profile}" method="post" th:object="${client}" class="profile-grid">
                <div class="grid-row">
                    <label>Имя:</label>
                    <input type="text" th:field="*{firstName}" required/>
                </div>
                <div class="grid-row">
                    <label>Фамилия:</label>
                    <input type="text" th:field="*{lastName}" required/>
                </div>
                <div class="grid-row">
                    <label>Возраст:</label>
                    <input type="number" th:field="*{age}" required/>
                </div>
                <div class="grid-row">
                    <label>Пол:</label>
                    <input type="text" th:field="*{gender}" required/>
                </div>
                <div class="grid-row">
                    <label>Адрес:</label>
                    <input type="text" th:field="*{address}" required/>
                </div>
                <div class="grid-row">
                    <label>Паспорт:</label>
                    <input type="text" th:field="*{passport}" required/>
                </div>

                <div class="profile-actions">
                    <button type="submit" class="button">Обновить профиль</button>
                </div>
            </form>
        </div>


        <!-- Список пациентов (React) -->
        <div th:if="${isAdminOrDoctor}">
            <h2>Список пациентов</h2>
            <div id="react-patient-manager-container" th:attr="data-user-role=${role}"></div>
        </div>

        <hr/>

        <div th:if="${role == 'ROLE_CLIENT'}" class="client-appointments">
            <hr/>
            <h2>Мои записи на приём</h2>
            <table class="data-table">
                <thead>
                <tr>
                    <th>Дата</th>
                    <th>Время</th>
                    <th>Услуга</th>
                    <th>Врач</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="rec : ${records}">
                    <td th:text="${rec.appointmentDate}"></td>
                    <td th:text="${rec.appointmentTime}"></td>
                    <td th:text="${rec.serviceName}"></td>
                    <td th:text="${rec.doctorId}"></td>
                </tr>
                </tbody>
            </table>

            <div class="admin-actions">
                <a th:href="@{/client/appointment/new}">Записаться на новый приём</a>
            </div>
        </div>

        <!-- Записи на приём (React) -->
        <div th:if="${isAdminOrDoctor}">
            <h2>Записи всех пациентов</h2>
            <div id="react-appointment-record-manager-container" th:attr="data-user-role=${role}"></div>
        </div>


        <!-- Сообщение для доктора -->
        <div th:if="${isAdminOrDoctor}">
            <p>Вы можете просматривать все записи, но не можете создавать новые.</p>
        </div>

        <hr/>

        <!-- История болезней React -->
        <div>
            <h2 th:if="${isAdminOrDoctor}">История болезни</h2>
            <h2 th:unless="${isAdminOrDoctor}">Ваша история болезни</h2>
            <div id="react-disease-history-manager-container" th:attr="data-user-role=${role}"></div>
        </div>


        <hr/>

        <!-- Результаты анализов React -->
        <div>
            <h2 th:if="${isAdminOrDoctor}">Все результаты анализов</h2>
            <h2 th:unless="${isAdminOrDoctor}">Ваши результаты анализов</h2>
            <div id="react-analysis-result-manager-container" th:attr="data-user-role=${role}"></div>
        </div>


        <!-- Таблица докторов React -->
        <div>
            <h2>Таблица докторов</h2>
            <div id="react-doctor-manager-container" th:attr="data-user-role=${role}"></div>
        </div>


        <div class="admin-actions">
            <button class="button" onclick="openModal('changePasswordModal')">Сменить пароль</button>

            <th:block sec:authorize="hasRole('ADMIN')">
                <a th:href="@{/auth/register/client}" class="button">Зарегистрировать клиента</a>
                <a th:href="@{/auth/register/doctor}" class="button">Добавить доктора</a>
            </th:block>
        </div>

    </th:block>
</th:block>
</html>
